esphome:
  name: ${esphome_name}

text_sensor:
  - platform: version
    name: "Firmware Version"
    id: firmware_version
    on_value:
        then:
          - lvgl.label.update:
              id: lbl_app_name
              text:
                format: "${esphome_name}\n%s"
                args: [ 'id(firmware_version).state.c_str()' ]  
#==========================================================================================================================
font:
  # - file: "gfonts://Roboto@medium"
  - file: 
      fonts/Roboto-Medium.ttf
    id: font_roboto_medium22
    size: 22
    glyphs: '!"%()+,-_.:°0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz/³µŋ'
    glyphsets:
      - GF_Latin_Core
      - GF_Latin_Plus
      - GF_Greek_Core
      - GF_Cyrillic_Core
#==========================================================================================================================
image:
  - file: https://esphome.io/favicon-512x512.png #relocated to remove _static location ref in url
    id: boot_logo
    resize: 200x200
    type: RGB565
    transparency: alpha_channel #JWS Changed syntax ESPHome 2025.8.0
#==========================================================================================================================

#==========================================================================================================================
lvgl:
  displays:
    - m5cores3_lcd
  resume_on_input: true #resume from pause on button press (encoder rotate)
  id: lv_id #Only reqd so that ota can force updates to lvgl display even when main loop not running
#==========================================================================================================================
  gradients:
    - id: color_bar
      direction: hor
      dither: none
      stops:
        - color: 0xFF0000
          position: 0
        - color: 0xFFFF00
          position: 42
        - color: 0x00FF00
          position: 84
        - color: 0x00FFFF
          position: 127
        - color: 0x0000FF
          position: 169
        - color: 0xFF00FF
          position: 212
        - color: 0xFF0000
          position: 255
    - id: blue_red_bar
      direction: hor
      dither: none
      stops:
        - color: blue
          position: 0
        - color: red
          position: 255
    - id: green_blue_bar
      direction: hor
      dither: none
      stops:
        - color: green
          position: 0
        - color: blue
          position: 255

  theme:
    label:
      text_font: montserrat_14 # set all your labels to use your custom defined font
    button:
      bg_color: 0x2F8CD8
      bg_grad_color: 0x005782
      bg_grad_dir: VER
      bg_opa: COVER
      border_color: 0x0077b3
      border_width: 1
      text_color: 0xFFFFFF
      pressed: # set some button colors to be different in pressed state
        bg_color: 0x006699
        bg_grad_color: 0x00334d
      checked: # set some button colors to be different in checked state
        bg_color: 0x1d5f96
        bg_grad_color: 0x03324A
        text_color: 0xfff300
#       focused:
# #        bg_color: 0x00cc00
#         border_color: 0xff0000
# #        bg_grad_dir: NONE
#         border_width: 4
    buttonmatrix:
#      bg_opa: COVER
      bg_opa: TRANSP
      border_color: 0x0077b3
      border_width: 0 #Must be same border width focussed and non-focussed otherwise buttons shift up from screen bottom when focussed
      text_color: 0xFFFFFF
      pad_all: 0
      # focused:
      #   # bg_color: 0x00cc00
      #   border_color: 0xff0000
      #   # bg_grad_dir: NONE
      #   border_width: 2
      items: # set all your buttonmatrix buttons to use your custom defined styles and font
        bg_color: 0x2F8CD8
        bg_grad_color: 0x005782
        bg_grad_dir: VER
        bg_opa: COVER
        border_color: 0x0077b3
        border_width: 1
        text_color: 0xFFFFFF
        text_font: montserrat_14
        pressed:
          bg_color: 0x006699
          bg_grad_color: 0x00334d
        checked:
          bg_color: 0x1d5f96
          bg_grad_color: 0x03324A
          text_color: 0x005580
        # focused:
        #   bg_color: 0x00cc00
        #   border_color: 0xff0000
        #   bg_grad_dir: NONE
        #   border_width: 2
        #   border_post: true
    switch:
      bg_color: 0xC0C0C0
      bg_grad_color: 0xb0b0b0
      bg_grad_dir: VER
      bg_opa: COVER
      focused:
        # bg_color: 0x00cc00
        border_color: 0xff0000
        # bg_grad_dir: NONE
        border_width: 2
      checked:
        bg_color: 0x1d5f96
        bg_grad_color: 0x03324A
        bg_grad_dir: VER
        bg_opa: COVER
      knob:
        bg_color: 0xFFFFFF
        bg_grad_color: 0xC0C0C0
        bg_grad_dir: VER
        bg_opa: COVER
    slider:
      border_width: 1
      border_opa: COVER
      bg_color: 0xcccaca
      bg_opa: COVER
      pad_all: 0
      pressed: #Occurs momentarily when changed value is accepted
        border_color: 0xff0000
        # bg_grad_dir: NONE
        border_width: 4
        border_opa: COVER
        bg_color: 0x00cc00 #only affects the background not covered by indicator bar
      # focused:
      #   border_color: 0xff0000
      #   # bg_grad_dir: NONE
      #   border_width: 2
      #   border_opa: COVER
      indicator:
        bg_color: 0x1d5f96
        bg_grad_color: 0x03324A
        bg_grad_dir: VER
        bg_opa: COVER
        # focused:
        #   # bg_color: 0x00cc00
        #   border_color: 0xff0000
        #   # bg_grad_dir: NONE
        #   border_width: 2
      knob:
        bg_color: 0x2F8CD8
        bg_grad_color: 0x005782
        bg_grad_dir: VER
        bg_opa: COVER
        border_color: 0x0077b3
        border_width: 1
        text_color: 0xFFFFFF
        # focused:
        #   bg_color: 0x00cc00
        #   border_color: 0xff0000
        #   bg_grad_dir: NONE
        #   border_width: 2
#==========================================================================================================================
  style_definitions:
    - id: header_footer
      bg_color: BLACK #0x2F8CD8
      bg_grad_color: 0x005782
      bg_grad_dir: VER
      bg_opa: TRANSP #COVER
      # border_opa: TRANSP
      radius: 0
      pad_all: 0
      pad_row: 0
      pad_column: 0
      border_color:  0x0077b3
      border_opa: COVER
      text_color: YELLOW
      width: 100%
      height: 30
      scrollbar_mode: "OFF" #Never show scrollbars which otherwise appear if we make an object to big for parent container

    - id: bar_temperature
      bg_color: BLACK
      bg_opa: COVER
      align: CENTER
    - id: indicator_temperature
      bg_grad: blue_red_bar
      bg_opa: 70%
      # align: RIGHT_MID
      bg_color: BLACK
    - id: bar_humidity
      bg_color: BLACK
      bg_opa: TRANSP #COVER
      align: CENTER
    - id: indicator_humidity
      bg_grad: green_blue_bar
      bg_opa: 70%
      # align: RIGHT_MID
      bg_color: BLACK
    - id: lbl_temperature_humidity
      text_align: RIGHT
      align: RIGHT_MID
      text_color: WHITE
      bg_color: BLACK
      bg_opa: TRANSP
    - id: obj_temperature_humidity
      align: RIGHT_MID
      text_color: WHITE
      bg_color: BLACK
      bg_opa: COVER
      border_color: BLACK
      border_width: 0

  top_layer:
    widgets:
      - label:
          text: "B"
          id: lbl_battery
#          hidden: true
          align: top_right
          x: -22
          y: 7
          text_align: right
          text_color: 0xFFFFFF
      - label:
          text: "\uF1EB" #WIFi symbol (will be overlaid by LEDs anyway)
          id: lbl_hastatus
          # hidden: true
          align: top_right
          x: 0 #-2
          y: 2 #6
          text_align: right
          # text_color: 0xFFFFFF
      - led:
          id: led_wifi
          align: top_right
          x: -6
          y: 2
          width: 12
          height: 12
          color: YELLOW
          brightness: 100%
          border_color: BLACK
          border_width: 1
          border_opa: COVER
      - led:
          id: led_mqtt
          align: top_right
          x: -6
          y: 16
          width: 12
          height: 12
          color: YELLOW
          brightness: 100%
          outline_color: BLACK
          outline_width: 1
          outline_opa: COVER
      - label:
          text: "Time" # Will be overwritten by the time update script
          id: lbl_time
          align: top_left
          x: 2
          y: 7
          text_align: left
          text_color: 0xFFFFFF
      - buttonmatrix:
          align: bottom_mid
          styles: header_footer
          pad_all: 0
          outline_width: 0
          id: top_layer
          items:
            styles: header_footer
          rows:
            - buttons:
              - id: focus_next
                text: "\uF053"
                on_press:
                  then:
                    - lvgl.page.previous:
                    - logger.log: "Left pressed"
              - id: page_home
                text: "\uF015"
                on_press:
                  then:
                    - logger.log: "Home pressed"
                    - lvgl.page.show: main_page
              - id: page_next
                text: "\uF054"
                on_press:
                  then:
                    - logger.log: "Next P pressed"
                    - lvgl.page.next:
      - obj:
          id: boot_screen
          x: 0
          y: 0
          width: 100%
          height: 100%
          bg_color: 0xffffff
          bg_opa: COVER
          radius: 0
          pad_all: 0
          border_width: 0
          widgets:
            - image:
                align: CENTER
                src: boot_logo
                y: -40
            - spinner:
                align: CENTER
                y: 95
                height: 50
                width: 50
                spin_time: 1s
                arc_length: 60deg
                arc_width: 8
                indicator:
                  arc_color: 0x18bcf2
                  arc_width: 8
          on_press:
            - logger.log: "Boot pressed"
            - lvgl.widget.hide: boot_screen
#==========================================================================================================================
  pages:
#==========================================================================================================================
#--------------------------------------------------------------------------
    - id: heating_page
      bg_color: 0x000000 #black
      widgets:
        - obj:
            align: TOP_MID
            styles: header_footer
            widgets:
              - label:
                  text: "Heating Control"
                  align: CENTER
                  text_align: CENTER
                  text_color: 0xFFFFFF #white
        - obj: # a properly placed coontainer object for all these controls
            text_color: white
            align: CENTER
            width: 320
            height: 180 #240-(2*30) #Display area less header & footer
            pad_all: 0
            bg_opa: TRANSP #COVER
            border_opa: TRANSP
            # outline_width: 1 #debug top check we fill available space
            layout: # enable the GRID layout for the children widgets
              type: GRID # split the rows and the columns proportionally
              grid_columns: [FR(1), FR(1)] # equal
              grid_rows: [FR(1), FR(1), FR(1), FR(1), FR(1), FR(1), FR(1), FR(1), FR(1), FR(1)] # like percents
              pad_row: 4
              pad_column: 8
            widgets:
              - button:
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 0 # the corresponding cell
                  grid_cell_column_span: 2 #Span 2 columns
                  grid_cell_row_span: 2 #Span 2 rows
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  id: btn_heating_pump
                  checkable: true
                  checked:
                    bg_color: red
                    text_color: black
                    bg_grad_dir: NONE
                  on_value:
                    then:
                      - logger.log:
                          format: "Heating Pump button state: %d"
                          args: [ x ]
                  widgets:
                    - label:
                        align: center
                        text: "Heating"
                  on_click:
                    - homeassistant.action:
                        action: switch.toggle
                        data:
                          entity_id: switch.heating_pump_switch_1
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 2 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_jim_study_temp
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_temperature
                    - label:
                        id: lbl_jim_study_temp
                        text: "Jim Study"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 3 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_jim_study_humidity
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_humidity
                    - label:
                        id: lbl_jim_study_humidity
                        text: "Jim Study"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 2 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_hall_temp
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_temperature
                    - label:
                        id: lbl_hall_temp
                        text: "Hall"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 3 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_hall_humidity
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_humidity
                    - label:
                        id: lbl_hall_humidity
                        text: "Hall"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 4 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_sue_study_temp
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_temperature
                    - label:
                        id: lbl_sue_study_temp
                        text: "Sue Study"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 5 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_sue_study_humidity
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_humidity
                    - label:
                        id: lbl_sue_study_humidity
                        text: "Sue Study"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 4 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_spare_rm_temp
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_temperature
                    - label:
                        id: lbl_spare_rm_temp
                        text: "Spare Rm"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 5 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_spare_rm_humidity
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_humidity
                    - label:
                        id: lbl_spare_rm_humidity
                        text: "Spare Rm"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 6 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_main_bed_rm_temp
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_temperature
                    - label:
                        id: lbl_main_bed_rm_temp
                        text: "Main Bed"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 7 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_main_bed_rm_humidity
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_humidity
                    - label:
                        id: lbl_main_bed_rm_humidity
                        text: "Main Bed"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 8 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_kitchen_temp
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_temperature
                    - label:
                        id: lbl_kitchen_temp
                        text: "Kitchen"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 9 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_kitchen_humidity
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_humidity
                    - label:
                        id: lbl_kitchen_humidity
                        text: "Kitchen"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 8 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_lounge_temp
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_temperature
                    - label:
                        id: lbl_lounge_temp
                        text: "Lounge"
                        styles: lbl_temperature_humidity
              - obj:
                  styles: obj_temperature_humidity
                  grid_cell_column_pos: 1 # place the widget in
                  grid_cell_row_pos: 9 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - bar:
                        id: bar_lounge_humidity
                        value: 100
                        styles: bar_temperature
                        indicator: 
                          styles: indicator_humidity
                    - label:
                        id: lbl_lounge_humidity
                        text: "Lounge"
                        styles: lbl_temperature_humidity
       
#==========================================================================================================================
    - id: main_page
      # on_load:
      #   - lvgl.widget.focus: top_layer # focus_next
      bg_color: 0x000000
      widgets:
        - obj: # Title block
            align: TOP_MID
            styles: header_footer
            widgets:
              - label:
                  text: "ESPHome Core3 Display"
                  align: CENTER
                  text_align: CENTER
                  text_color: 0xFFFFFF
        - obj: # a properly placed coontainer object for all these controls
            text_color: 0xFFFFFF
            align: CENTER
            width: 320
            height: 160 #240-(2*30) #Display area less header & footer
            pad_all: 6
            bg_opa: TRANSP
            border_opa: TRANSP
            outline_width: 1 #debug
            layout: # enable the GRID layout for the children widgets
              type: GRID # split the rows and the columns proportionally
              grid_columns: [FR(1), FR(1), FR(1)] # equal
              grid_rows: [FR(1), FR(1), FR(1), FR(1)] # like percents
              pad_row: 6
              pad_column: 8
            widgets:
              - label:
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 0 # the corresponding cell
                  grid_cell_column_span: 2 #Span 2 columns as firmware version is a long string
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  id: lbl_app_name
                  text: ${esphome_name}
              - label:
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 1 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  id: lbl_wifi_strength
                  text: wifi
              - label:
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 2 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  id: lbl_wifi_ssid
                  text: ssid
              - label:
                  grid_cell_column_pos: 0 # place the widget in
                  grid_cell_row_pos: 3 # the corresponding cell
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  id: lbl_wifi_ip
                  text: ip addr
#==========================================================================================================================
    - id: ota_page
      bg_color: pink
      skip: true #don't include in menu cycle
      widgets:
        - obj:
            align: TOP_MID
            styles: header_footer
            widgets:
              - label:
                  text: "Firmware Update"
                  align: CENTER
                  text_align: CENTER
                  text_color: 0xFFFFFF
        - bar:
            x: 50
            y: 100
            width: 220
            id: bar_ota_progress
            value: 1
            min_value: 0
            max_value: 100 #OTA progress
        - label:
            x: 50
            y: 50
            text_font: montserrat_28 # Bigger text
            id: lbl_ota_source
            text: "OTA"
